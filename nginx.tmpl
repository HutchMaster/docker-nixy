# Example template of how to use Nginx to load balance TCP and UDP.
load_module /usr/lib/nginx/modules/ngx_stream_js_module.so;
worker_processes auto;
pid /var/run/nginx.pid;
user root;

events {
    use epoll;
    worker_connections 524288;
}
stream {
    js_import stream.js;  
    js_set $server_choice stream.getUpstream;
    js_var $js_stream_port $remote_port;
    js_var $js_stream_addr $remote_addr

    server {
        js_preread stream.readLastOctet;
        error_log /var/log/nginx/error.log info;
        listen 10500 udp reuseport;
        proxy_timeout 20s;                
        proxy_pass $server_choice;
    }
}