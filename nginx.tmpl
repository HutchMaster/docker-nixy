# Example template of how to use Nginx to load balance TCP and UDP.
worker_processes auto;
pid /var/run/nginx.pid;

events {
    use epoll;
    worker_connections 2048;
    multi_accept on;
}
stream {
    {{- range $appid, $app := .Apps}}
        upstream udp_upstreams {
            {{- if $app.Labels.UDPLoadBalanced}}
            
                {{- range $task := $app.Tasks}}
                    server {{ $task.Host }}:{{ index $task.Ports 1 }};
                {{- end}}
            {{- end}}
        }
    {{- end}}
    server {
        listen 10500;
        proxy_pass udp_upstreams;
    }
}